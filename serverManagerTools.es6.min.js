exports.serverManagerTools=function(){let e={},t=new Event("websocket_onconnect"),s=new Event("websocket_ondisconnect"),o=null,r=[],n={},a,i,c={},l,d="https"===location.protocol?"wss://":"ws://",u={};const g={cookie:{read:e=>{let t=escape(e)+"=";document.cookie.split("; ").foreach(e=>{if(e.substr(0,t.length)===t)return unescape(e.substr(t.length))})},write:(e,t,s)=>{document.cookie=escape(e)+"="+escape(t)+(s?"; max-age="+s:"")},delete:e=>{document.cookie=escape(e)+"=; max-age=-1"}},http:{options:{postDelay:10},fetch:(t,s)=>{if(e[t]&&g.equals(s,e[t].parameters)){let s=Promise.resolve(e[t].response);return e[t].isPermanent||delete e[t],s}return new Promise((a,i)=>{let c=(new Date).getTime()+Math.random(),l;n[c]={resolve:a,reject:i},l=sessionStorage&&sessionStorage.getItem?sessionStorage.sessionId:cookie.read("sessionId");let d={requestId:c,action:t};s&&(d.parameters=s),r.push(d),o&&clearTimeout(o),o=setTimeout(()=>{clearTimeout(o),o=null;let t={actions:r};l&&(t.sessionId=l),fetch("/",{method:"POST",cache:"no-cache",body:JSON.stringify(t)}).then(t=>{sessionStorage&&sessionStorage.setItem?sessionStorage.setItem("sessionId",t.sessionId):cookie.write("sessionId",t.sessionId),Object.assign(e,t.buffer);for(let e in t.responses){let s=t.responses[e];if("error"===s.status)return void n[e].reject(s.data);n[e].resolve(s.data),delete n[e]}},e=>{t.actions.forEach(t=>{n[t.requestId].reject(e.statusText)})}),r=[]},g.http.options.postDelay||10)})}},webSocket:{options:{},loader:new Promise((e,t)=>{l={resolve:e,reject:t}}),supported:!!WebSocket,start:e=>(g.webSocket.optios=e,i=new S,g.webSocket.loader),addListener:(e,t)=>{c[e]=t},fetch:(t,s)=>{if(e[t]&&$.equals(s,e[t].parameters)){let s=Promise.resolve(e[t].response);return e[t].isPermanent||delete e[t],s}let o={requestId:(new Date).getTime()+Math.random(),action:t},r;return(r=sessionStorage&&sessionStorage.getItem?sessionStorage.sessionId:cookie.read("sessionId"))&&(o.sessionId=r),s&&(o.parameters=s),new Promise((e,t)=>{1===i.readyState?(u[o.requestId]={resolve:e,reject:t},i.send(JSON.stringify(o))):t()}).catch(e=>{})}},server:{loader:new Promise((e,t)=>{a={resolve:e,reject:t}}),start:e=>{let t=[];return(e=e||{}).webSocket=!!e.webSocket&&g.webSocket.supported,g.http.options=e,e.webSocket?(g.webSocket.start(e).then(()=>{g.server.fetch=g.webSocket.fetch,g.server.addListener=g.webSocket.addListener,g.server.usingWebSocket=!0,a.resolve()}),g.server.loader):(g.server.fetch=g.http.fetch,g.server.addListener=(()=>{}),g.server.usingWebSocket=!1,a.resolve(),g.server.loader)},readStore:(e,t)=>{let s;if(void 0===(s=localStorage&&localStorage.getItem?localStorage.getItem(e):cookie.read(e)))return t;try{return JSON.parse(s)}catch(e){return t}},writeStore:(e,t,s)=>{s&&localStorage&&localStorage.setItem?localStorage.setItem(e,JSON.stringify(t)):sessionStorage&&sessionStorage.setItem?sessionStorage.setItem(e,JSON.stringify(t)):cookie.write(e,JSON.stringify(t),s)},deleteStore:e=>{localStorage&&localStorage.deleteItem?localStorage.deleteItem(e):cookie.delete(e)},sessionId:()=>sessionStorage&&sessionStorage.getItem?sessionStorage.sessionId:cookie.read("sessionId")},equals:(e,t,s)=>{if(e===t||s&&e==t)return!0;if(isNaN(e))return isNaN(t);let o=typeof e;if(o!==typeof t||["string","number","boolean"].includes(o)||["string","number","boolean"].includes(type2))return!1;if(Array.isArray(e))return!!Array.isArray(t)&&(e.length===t.length&&e.every((e,o)=>g.equals(e,t[o],s)));if(e instanceof Date)return+e==+t;if(e instanceof Function||t instanceof Function)return!1;const r=Object.getOwnPropertyNames(e),n=Object.getOwnPropertyNames(t);return r.length===n.length&&r.every((o,r)=>o===keys[r]&&(e[o]instanceof Function?t[o]instanceof Function:g.equals(e[o],t[o],s)))}};return g.webSocket.supported||l.resolve(),g;function S(){let o=new WebSocket(d+location.host);return o.onmessage=(t=>{try{let s=JSON.parse(t.data),o=u[s.requestId];if("error"===s.status)return void o.reject(s.data);s.buffer&&Object.assign(e,s.buffer),sessionStorage&&sessionStorage.setItem?sessionStorage.setItem("sessionId",s.sessionId):cookie.write("sessionId",s.sessionId);for(let e in c)if(e===s.requestId)return void c[e](s.data);o.resolve(s.data)}catch(e){console.log("WebSocket Error",e)}}),o.onopen=(()=>{document.dispatchEvent(t),l.resolve()}),o.onclose=(()=>{document.dispatchEvent(s)&&(i=new S)}),o}}();